<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Deploy Your Application &#8212; NPL 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NPL Packages" href="npl_packages.html" />
    <link rel="prev" title="Object Oriented Programming" href="ObjectOriented.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="deploy-your-application">
<span id="deploy-your-application"></span><h1>Deploy Your Application<a class="headerlink" href="#deploy-your-application" title="Permalink to this headline">¶</a></h1>
<p>You can deploy your application to windows, linux, ios, android, etc. Both 32bits/64bits versions are supported.</p>
<ul class="simple">
<li>NPL scripts can be deployed in plain <code class="docutils literal"><span class="pre">*.lua</span> <span class="pre">or</span> <span class="pre">*.npl</span></code> text files or in precompiled <code class="docutils literal"><span class="pre">*.o</span></code> binary file.</li>
<li>You can also buddle all or part of your scripts or any other read-only resource files into one or more zipped archive files.</li>
<li>You can deploy NPL runtime globally or side-by-side with your application files.</li>
</ul>
<p>For automatic deployment, please install and use <code class="docutils literal"><span class="pre">ParacraftSDK</span></code>. This articles explains how to do it manually.</p>
<div class="section" id="pre-compiling-npl-script">
<span id="pre-compiling-npl-script"></span><h2>Pre-compiling NPL script<a class="headerlink" href="#pre-compiling-npl-script" title="Permalink to this headline">¶</a></h2>
<p>Precompiled NPL script is called bytecode in lua. The bytecode generated by <code class="docutils literal"><span class="pre">Luajit</span></code> is incompatible with bytecode generated by <code class="docutils literal"><span class="pre">lua</span></code>, but is cross-platform for any (32bits/64bits) architecture. If you choose to deploy your app with bytecode, you must also choose to use luajit or lua when deploying NPL runtime.</p>
<p>Please read the documentation in <code class="docutils literal"><span class="pre">NPLCompiler.lua</span></code> for more information.
Examples:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">NPL</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;(gl)script/ide/Debugger/NPLCompiler.lua&quot;</span><span class="p">);</span>
<span class="n">NPL</span><span class="p">.</span><span class="n">CompileFiles</span><span class="p">(</span><span class="s2">&quot;script/*.lua&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="buddle-scripts-in-zip-files">
<span id="buddle-scripts-in-zip-files"></span><h2>Buddle Scripts in Zip files<a class="headerlink" href="#buddle-scripts-in-zip-files" title="Permalink to this headline">¶</a></h2>
<p>You can buddle your script and assets in zip files.
There are two kinds of zip files: one is the standard <code class="docutils literal"><span class="pre">*.zip</span></code> file, the other is called <code class="docutils literal"><span class="pre">*.pkg</span></code> file.
You can create <code class="docutils literal"><span class="pre">*.pkg</span></code> file from a standard zip file with the NPL runtime like below. <code class="docutils literal"><span class="pre">*.pkg</span></code> use a simple encription algorithm over the zip file.</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">ParaAsset</span><span class="p">.</span><span class="n">GeneratePkgFile</span><span class="p">(</span><span class="s2">&quot;main.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;main.pkg&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>When application starts, NPL runtime will automatically load all <code class="docutils literal"><span class="pre">main*.pkg</span></code> and <code class="docutils literal"><span class="pre">main*.zip</span></code> files in the application&#8217;s start directory into memory. The load order is based on file name, so that the a file in &#8220;main_patch2.pkg&#8221; will overwrite the same file in &#8220;main_patch1.pkg&#8221;.</p>
<p>Please note that loading <code class="docutils literal"><span class="pre">pkg</span></code> file is very fast, it only copys the file into memory, individual script file or assets are only unzipped and parsed on first use.</p>
<p>A programmer can also programmatically load or unload any archive file using the NPL API like below.</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">NPL</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;pluginABC.pkg&quot;</span><span class="p">);</span>
<span class="c1">-- or using explicit calls</span>
<span class="n">ParaAsset</span><span class="p">.</span><span class="n">OpenArchive</span><span class="p">(</span><span class="s2">&quot;pluginABC.pkg&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The second parameter is whether to use relative path in archive files. (i.e. file path in archive file are relative to the containing directory). Search paths, such as from [[npl_packages]] are honored when loading archives.</p>
</div>
<div class="section" id="deploy-nplruntime-side-by-side">
<span id="deploy-nplruntime-side-by-side"></span><h2>Deploy NPLRuntime Side-By-Side<a class="headerlink" href="#deploy-nplruntime-side-by-side" title="Permalink to this headline">¶</a></h2>
<p>Deploying NPL Runtime side-by-side is as easy as copying all executable files to the application directory.
The recommended deployment folder structures is below</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="p">:</span> <span class="n">npl</span> <span class="n">exe</span><span class="p">,</span> <span class="n">dll</span><span class="p">,</span> <span class="n">lua</span><span class="p">,</span><span class="n">luajit</span><span class="p">,</span> <span class="n">etc</span>
<span class="n">packages</span><span class="o">/</span><span class="p">:</span> <span class="n">common</span> <span class="o">*.</span><span class="n">pkg</span> <span class="o">*.</span><span class="n">zip</span> <span class="n">package</span> <span class="n">files</span>
<span class="n">script</span><span class="o">/</span><span class="p">:</span> <span class="n">your</span> <span class="n">own</span> <span class="n">script</span> <span class="n">files</span>
<span class="n">config</span><span class="o">.</span><span class="n">txt</span>
<span class="nb">any</span> <span class="n">other</span> <span class="n">files</span>
</pre></div>
</div>
<p>Another way is to deploy everything to the application root directory.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">script</span><span class="o">/</span><span class="p">:</span> <span class="n">your</span> <span class="n">own</span> <span class="n">script</span> <span class="n">files</span>
<span class="n">npl</span> <span class="n">exe</span><span class="p">,</span> <span class="n">dll</span><span class="p">,</span> <span class="n">lua</span><span class="p">,</span><span class="n">luajit</span><span class="p">,</span> <span class="n">etc</span>
<span class="n">common</span> <span class="o">*.</span><span class="n">pkg</span> <span class="o">*.</span><span class="n">zip</span> <span class="n">package</span> <span class="n">files</span>
<span class="n">config</span><span class="o">.</span><span class="n">txt</span>
<span class="nb">any</span> <span class="n">other</span> <span class="n">files</span>
</pre></div>
</div>
<blockquote>
<div>if <code class="docutils literal"><span class="pre">config.txt</span></code> file is on the root application directory. Its cmdline content will be appended to NPL command line when running NPL runtime from this directory.</div></blockquote>
<p>An example <code class="docutils literal"><span class="pre">config.txt</span></code>, see below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cmdline</span><span class="o">=</span><span class="n">noupdate</span><span class="o">=</span><span class="s2">&quot;true&quot;</span> <span class="n">debug</span><span class="o">=</span><span class="s2">&quot;main&quot;</span> <span class="n">bootstrapper</span><span class="o">=</span><span class="s2">&quot;script/apps/HelloWorld/main.lua&quot;</span>
</pre></div>
</div>
<div class="section" id="luajit-vs-lua">
<span id="luajit-vs-lua"></span><h3>Luajit vs Lua<a class="headerlink" href="#luajit-vs-lua" title="Permalink to this headline">¶</a></h3>
<p>Luajit and Lua are ABI-compatible, meaning that you can deploy NPL runtime with them simply by replacing <code class="docutils literal"><span class="pre">lua.dll(so)</span></code> with either implementation. Luajit is the recommended way for release deployment on all platforms. However, currently on iOS, Luajit is used but disabled, since it is not allowed. Even a disabled luajit runs faster than lua and its bytecode is the same for both 32bits and 64bits OS.  So you would only want to deploy lua dll for debugging purposes on development machines.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Deploy Your Application</a><ul>
<li><a class="reference internal" href="#pre-compiling-npl-script">Pre-compiling NPL script</a></li>
<li><a class="reference internal" href="#buddle-scripts-in-zip-files">Buddle Scripts in Zip files</a></li>
<li><a class="reference internal" href="#deploy-nplruntime-side-by-side">Deploy NPLRuntime Side-By-Side</a><ul>
<li><a class="reference internal" href="#luajit-vs-lua">Luajit vs Lua</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ObjectOriented.html" title="previous chapter">Object Oriented Programming</a></li>
      <li>Next: <a href="npl_packages.html" title="next chapter">NPL Packages</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/documentation/DeployGuide.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Zhiyuan.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/documentation/DeployGuide.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>